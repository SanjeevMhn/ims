<div class="wrapper text-[62.5%] h-screen w-full p-[2em] flex flex-col">
  @if(getWeeks$ | async; as weeks){
  <header class="flex gap-[1.5em] items-center mb-[1.5em]">
    <form [formGroup]="currentMonthForm">
      <input
        type="month"
        name=""
        id=""
        formControlName="month"
        class="form-control"
        (change)="onMonthChange($event)"
      />
    </form>

    <select name="" id="" class="form-control" (change)="onViewChange($event)">
        <option value="month">Month</option>
        <option value="week">Week</option>
    </select>
    <!-- <select name="" id="" class="form-control" (change)="onWeekChange($event)">
      <option value="null">Select Week</option>
      @for(week of getTotalWeeks(); track week){
      <option [value]="week">Week {{ week }}</option>
      }
    </select> -->
    @if(viewChange$ | async; as currentView){
    <div class="pagination-container flex items-center gap-[0.5em]">
        <button type="button" class="pagination-btn cursor-pointer p-[0.8em] rounded-full bg-[#dffbf6] border border-[#adadad]" (click)="prevView(currentView)">
            <span class="icon-container">
                <lucide-angular [img]="chevronleft" />
            </span>
        </button>
       <button type="button" class="pagination-btn cursor-pointer  p-[0.8em] rounded-full bg-[#dffbf6] border border-[#adadad]" (click)="nextView(currentView)">
            <span class="icon-container">
                <lucide-angular [img]="chevronright" />
            </span>
        </button>
    </div>
    }
    <!-- <select name="" id="" class="form-control">
        <option value="null">Select Supplier</option>
        @for(supplier of supplierDelivery; track supplier.id){
            <option [value]="supplier.supplier_name">{{supplier.supplier_name}}</option>
        }
    </select> -->
    <h2 class="text-[2em] font-semibold ml-auto">Supplier Product Delivery Calendar</h2>
  </header>
  <div class="table-container w-full overflow-y-auto grow">
    <table class="calendar-table w-full">
      <thead class="sticky top-0">
        <tr>
            <th rowspan="2">Supplier</th>
            <th rowspan="2" class="align-middle">Product</th>
            <td rowspan="2" class="p-0! border-0!" [attr.colspan]="weeks.length + 1">
                <table class="w-full h-full text-[62.5%]">
                    <td [attr.colspan]="weeks.length" class="p-0! border-0!">
                        <table class="w-full h-full text-[62.5%]">
                            <tr>
                                @for(week of weeks; track $index){
                                <td
                                    [class.text-neutral-400]="!week.is_current"
                                    class="border-0! border-b! border-r! font-medium text-center min-w-[5em] uppercase"
                                >
                                    {{ week == null ? $index + 1 : week.dayName }}
                                </td>
                                }
                            </tr>
                            <tr>
                                @for(week of weeks; track $index){
                                <td
                                    [class.text-neutral-400]="!week.is_current"
                                    class="border-0! border-r! border-b! min-w-[5em] font-semibold text-center text-[1.8em]!"
                                >
                                    {{ week == null ? $index + 1 : week.dayIndex }}
                                </td>
                                }
                            </tr>
                           
                        </table>
                    </td>
                </table>
            </td>
        </tr>
      </thead>
      <tbody>
        @for(delivery of supplierDelivery; track delivery.id){
            <tr class="main-tr">
                <td class="border-0! border-b!">{{delivery.supplier_name}}</td>
                <td class="p-0! border-0!">
                    <table class="text-[62.5%] w-full">
                        @for(product of delivery.supplier_products; track product.id){
                            <tr>
                                <td class="border-0! border-l! border-b!">{{product.product_name}}</td>
                            </tr>
                        }
                    </table> 
                </td>
                <td class="p-0! border-0!" [attr.colspan]="weeks.length + 2">
                    <table class="text-[62.5%] w-full">
                        @for(product of delivery.supplier_products; track product.id){
                            <tr>
                                @for(week of weeks; track $index){
                                    <td class="h-[2.5em] max-h-[3.5em] border-0! border-l! border-b! w-[3.5em] data-td">
                                        @for(supp of supplierDelivery; track supp.id){
                                            @for(delivery of supp.delivery; track delivery.id){
                                                @if(delivery.delivery_date == week.fullDate && delivery.delivery_product == product.product_name){
                                                    {{delivery.delivery_product_amount}}
                                                }
                                            }
                                        }
                                    </td>
                                }
                            </tr>
                        }
                    </table>
                </td>
            </tr>
        }
      </tbody>
    </table>
  </div>
  }
</div>
<router-outlet />
